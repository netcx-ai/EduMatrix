{extend name="common/base" /}

{block name="content"}
<div class="layui-card">
    <div class="layui-card-header">
        <div class="layui-row">
            <div class="layui-col-md6">
                <span class="layui-breadcrumb">
                    <a href="/admin/index/index">首页</a>
                    <a href="/admin/system_config/index">系统配置</a>
                    <a><cite>编辑配置</cite></a>
                </span>
            </div>
        </div>
    </div>
    <div class="layui-card-body">
        <form class="layui-form" action="">
            <input type="hidden" name="id" value="{$config.id}">
            
            <div class="layui-form-item">
                <label class="layui-form-label">配置类型</label>
                <div class="layui-input-block">
                    <input type="text" value="{$config.type}" class="layui-input" disabled>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">配置名称</label>
                <div class="layui-input-block">
                    <input type="text" name="name" value="{$config.name}" required lay-verify="required" placeholder="请输入配置名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">服务商</label>
                <div class="layui-input-block">
                    <input type="text" value="{$config.driver}" class="layui-input" disabled>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">配置信息</label>
                <div class="layui-input-block">
                    <textarea name="config" placeholder="请输入配置信息（JSON格式）" class="layui-textarea" style="height: 200px;">{$config.config|json_encode}</textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-block">
                    <input type="radio" name="status" value="1" title="启用" {if $config.status==1}checked{/if}>
                    <input type="radio" name="status" value="0" title="禁用" {if $config.status==0}checked{/if}>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">默认配置</label>
                <div class="layui-input-block">
                    <input type="radio" name="is_default" value="1" title="是" {if $config.is_default==1}checked{/if}>
                    <input type="radio" name="is_default" value="0" title="否" {if $config.is_default==0}checked{/if}>
                </div>
            </div>
            
            <div class="layui-form-item">
                <label class="layui-form-label">备注说明</label>
                <div class="layui-input-block">
                    <textarea name="remark" placeholder="请输入备注说明" class="layui-textarea">{$config.remark}</textarea>
                </div>
            </div>
            
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="edit">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</div>
{/block}

{block name="script"}
<script>
layui.use(['form', 'layer'], function(){
    var form = layui.form;
    var layer = layui.layer;
    
    // 监听提交
    form.on('submit(edit)', function(data){
        // 将config字段的JSON字符串转换为数组
        try {
            data.field.config = JSON.parse(data.field.config);
        } catch(e) {
            layer.msg('配置信息必须是有效的JSON格式', {icon: 2});
            return false;
        }

        var loading = layer.load(2);
        $.ajax({
            url: '/admin/system_config/edit',
            type: 'POST',
            data: data.field,
            success: function(res){
                layer.close(loading);
                if(res.code == 1){
                    layer.msg(res.msg, {icon: 1}, function(){
                        location.href = '/admin/system_config/index';
                    });
                }else{
                    layer.msg(res.msg, {icon: 2});
                }
            },
            error: function(){
                layer.close(loading);
                layer.msg('服务器错误', {icon: 2});
            }
        });
        return false;
    });
});
</script>
{/block} 