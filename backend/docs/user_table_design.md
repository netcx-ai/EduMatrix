# ç”¨æˆ·è¡¨è®¾è®¡è¯´æ˜

## ğŸ“‹ ç”¨æˆ·è¡¨ç”¨é€”åˆ†æ

### ğŸ¯ ç”¨æˆ·è¡¨ï¼ˆedu_userï¼‰çš„å®šä½

ç”¨æˆ·è¡¨è®¾è®¡ä¸º**ç»Ÿä¸€èº«ä»½è®¤è¯ä¸­å¿ƒ**ï¼Œä¸»è¦ç”¨é€”ï¼š

#### âœ… **ä¿ç•™ç”¨æˆ·è¡¨çš„åŸå› **
1. **ç»Ÿä¸€ç™»å½•è®¤è¯**
   - ç”¨æˆ·å/å¯†ç ç®¡ç†
   - ç™»å½•çŠ¶æ€ç»´æŠ¤
   - å®‰å…¨æœºåˆ¶ï¼ˆå¯†ç é”™è¯¯æ¬¡æ•°ã€é”å®šç­‰ï¼‰

2. **åŸºç¡€ä¿¡æ¯ç®¡ç†**
   - ä¸ªäººåŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€æ‰‹æœºã€é‚®ç®±ï¼‰
   - å¤´åƒã€æ€§åˆ«ã€ç”Ÿæ—¥ç­‰é€šç”¨å­—æ®µ
   - è®¿é—®ç»Ÿè®¡ã€ç™»å½•è®°å½•

3. **è·¨è§’è‰²æ”¯æŒ**
   - ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ˜¯æ•™å¸ˆã€ç®¡ç†å‘˜ã€æ™®é€šä¼šå‘˜
   - æ”¯æŒå¤šå­¦æ ¡å…³è”
   - ç»Ÿä¸€çš„æƒé™ç®¡ç†

4. **ä¼šå‘˜ä½“ç³»**
   - ä¼šå‘˜ç­‰çº§ç®¡ç†
   - ç§¯åˆ†ç³»ç»Ÿ
   - åˆ°æœŸæ—¶é—´æ§åˆ¶

#### ğŸ”„ **ç”¨æˆ·è¡¨ä¸æ•™å¸ˆè¡¨çš„å…³ç³»**

```
edu_user (ç”¨æˆ·è¡¨)
â”œâ”€â”€ åŸºç¡€ä¿¡æ¯ï¼šusername, password, real_name, phone, email
â”œâ”€â”€ ä¼šå‘˜ä¿¡æ¯ï¼šmember_level, points, member_expire_time
â”œâ”€â”€ å®‰å…¨ä¿¡æ¯ï¼špassword_error_count, last_password_change
â”œâ”€â”€ ç»Ÿè®¡ä¿¡æ¯ï¼švisit_count, last_visit_time
â””â”€â”€ ç±»å‹æ ‡è¯†ï¼šuser_type, primary_school_id, teacher_no

edu_teacher (æ•™å¸ˆè¡¨)
â”œâ”€â”€ å­¦æ ¡ä¿¡æ¯ï¼šschool_id, college_id
â”œâ”€â”€ å…³è”ç”¨æˆ·ï¼šuser_id -> edu_user.id
â”œâ”€â”€ æ•™å¸ˆä¿¡æ¯ï¼šteacher_no, title, department, position
â”œâ”€â”€ ä¸“ä¸šä¿¡æ¯ï¼šeducation, major, teaching_subject
â””â”€â”€ çŠ¶æ€ç®¡ç†ï¼šstatus, is_verified, verified_time
```

### ğŸ—ï¸ æ•°æ®è®¾è®¡ç­–ç•¥

#### **æ–¹æ¡ˆä¸€ï¼šå…³è”æ¨¡å¼ï¼ˆæ¨èï¼‰**
```sql
-- ç”¨æˆ·è¡¨ï¼šç»Ÿä¸€èº«ä»½è®¤è¯
edu_user
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ username (ç”¨æˆ·å)
â”œâ”€â”€ password (å¯†ç )
â”œâ”€â”€ real_name (çœŸå®å§“å)
â”œâ”€â”€ phone (æ‰‹æœºå·)
â”œâ”€â”€ email (é‚®ç®±)
â”œâ”€â”€ user_type (ç”¨æˆ·ç±»å‹ï¼šmember/teacher/admin/school_admin)
â”œâ”€â”€ primary_school_id (ä¸»è¦å­¦æ ¡ID)
â”œâ”€â”€ teacher_no (æ•™å¸ˆå·¥å·ï¼Œä»…æ•™å¸ˆç”¨æˆ·)
â””â”€â”€ ... (å…¶ä»–é€šç”¨å­—æ®µ)

-- æ•™å¸ˆè¡¨ï¼šæ•™å¸ˆç‰¹æœ‰ä¿¡æ¯
edu_teacher
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ user_id (å…³è”ç”¨æˆ·ID)
â”œâ”€â”€ school_id (å­¦æ ¡ID)
â”œâ”€â”€ college_id (å­¦é™¢ID)
â”œâ”€â”€ teacher_no (æ•™å¸ˆå·¥å·)
â”œâ”€â”€ title (èŒç§°)
â”œâ”€â”€ department (éƒ¨é—¨)
â””â”€â”€ ... (å…¶ä»–æ•™å¸ˆç‰¹æœ‰å­—æ®µ)
```

#### **ä¼˜åŠ¿åˆ†æ**
1. **æ•°æ®ä¸€è‡´æ€§**ï¼šç”¨æˆ·åŸºç¡€ä¿¡æ¯ç»Ÿä¸€ç®¡ç†
2. **æƒé™ç»Ÿä¸€**ï¼šç™»å½•è®¤è¯ã€å®‰å…¨æœºåˆ¶ç»Ÿä¸€
3. **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒç”¨æˆ·å¤šè§’è‰²ã€å¤šå­¦æ ¡
4. **ç»´æŠ¤ç®€å•**ï¼šå‡å°‘æ•°æ®å†—ä½™ï¼Œä¾¿äºç»´æŠ¤

### ğŸ“Š ä½¿ç”¨åœºæ™¯

#### **åœºæ™¯1ï¼šæ•™å¸ˆæ³¨å†Œ**
```php
// 1. åˆ›å»ºç”¨æˆ·è®°å½•
$user = User::create([
    'username' => 'teacher001',
    'password' => 'hashed_password',
    'real_name' => 'å¼ è€å¸ˆ',
    'phone' => '13800138000',
    'user_type' => 'teacher',
    'teacher_no' => 'T2024001'
]);

// 2. åˆ›å»ºæ•™å¸ˆè®°å½•
$teacher = Teacher::create([
    'user_id' => $user->id,
    'school_id' => 1,
    'college_id' => 1,
    'teacher_no' => 'T2024001',
    'title' => 'å‰¯æ•™æˆ',
    'department' => 'è®¡ç®—æœºå­¦é™¢'
]);
```

#### **åœºæ™¯2ï¼šæ•™å¸ˆç™»å½•**
```php
// é€šè¿‡ç”¨æˆ·è¡¨éªŒè¯ç™»å½•
$user = User::where('username', $username)->first();
if ($user && $user->verifyPassword($password)) {
    // è·å–æ•™å¸ˆä¿¡æ¯
    $teacher = Teacher::where('user_id', $user->id)->first();
    // è®¾ç½®ç™»å½•çŠ¶æ€
    $user->updateLoginInfo();
}
```

#### **åœºæ™¯3ï¼šè·¨å­¦æ ¡æ•™å¸ˆ**
```php
// ä¸€ä¸ªç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªå­¦æ ¡ä»»æ•™
$user = User::find(1);
$teachers = Teacher::where('user_id', $user->id)->get();
// è¿”å›è¯¥ç”¨æˆ·åœ¨å¤šä¸ªå­¦æ ¡çš„æ•™å¸ˆè®°å½•
```

### ğŸ”§ è¿ç§»ç­–ç•¥

#### **ç°æœ‰æ•°æ®è¿ç§»**
å¦‚æœå·²æœ‰æ•™å¸ˆæ•°æ®ï¼Œéœ€è¦ï¼š

1. **åˆ›å»ºç”¨æˆ·è®°å½•**
```sql
INSERT INTO edu_user (username, password, real_name, phone, email, user_type, teacher_no)
SELECT teacher_no, password, real_name, phone, email, 'teacher', teacher_no
FROM old_teacher_table;
```

2. **æ›´æ–°æ•™å¸ˆè¡¨**
```sql
UPDATE edu_teacher SET user_id = (
    SELECT id FROM edu_user WHERE teacher_no = edu_teacher.teacher_no
);
```

### ğŸ“ æ€»ç»“

**ç”¨æˆ·è¡¨ä»ç„¶é‡è¦**ï¼ŒåŸå› ï¼š
- âœ… ç»Ÿä¸€èº«ä»½è®¤è¯
- âœ… åŸºç¡€ä¿¡æ¯ç®¡ç†
- âœ… è·¨è§’è‰²æ”¯æŒ
- âœ… ä¼šå‘˜ä½“ç³»
- âœ… å®‰å…¨æœºåˆ¶

**æ•™å¸ˆè¡¨çš„ä½œç”¨**ï¼š
- ğŸ¯ å­˜å‚¨æ•™å¸ˆç‰¹æœ‰ä¿¡æ¯
- ğŸ¯ å­¦æ ¡å…³è”ç®¡ç†
- ğŸ¯ ä¸“ä¸šä¿¡æ¯ç»´æŠ¤
- ğŸ¯ çŠ¶æ€ç®¡ç†

è¿™ç§è®¾è®¡æ—¢ä¿æŒäº†æ•°æ®çš„ç»Ÿä¸€æ€§ï¼Œåˆæ»¡è¶³äº†ä¸šåŠ¡çš„ä¸“ä¸šæ€§éœ€æ±‚ã€‚ 